(()=>{let t=JSON.parse(localStorage.getItem("products"));const e=document.querySelector("#cart");if(null===t){const t=document.createElement("p");t.textContent="Votre panier ne contient aucun article.",t.classList.add("m-2","p-4","fs-5"),e.appendChild(t),document.getElementById("customer-form").style.display="none",document.getElementById("customer-form").setAttribute("aria-hidden","true")}else{let n=[];const r=document.createElement("div");r.classList.add("d-flex","flex-wrap"),e.appendChild(r),t.forEach((e=>{const o=document.createElement("article");o.classList.add("mx-auto","m-3","p-2","border","rounded-3","bg-body","text-center"),r.appendChild(o);const c=document.createElement("h2");c.textContent=`${e.sentProductName}`,o.appendChild(c);const a=document.createElement("a");a.setAttribute("href",`product.html?id=${e.sentProductId}`),o.appendChild(a);const s=document.createElement("img");s.setAttribute("src",e.sentProductUrl),s.setAttribute("alt",`${e.sentProductName} ajouté au panier`),s.classList.add("img-thumbnail","image-mid-height"),a.appendChild(s);const d=document.createElement("p");d.innerHTML=`Couleur : <b>${e.sentProductVariation}</b>`,o.appendChild(d);const i=document.createElement("p");i.innerHTML=`Quantité : <b>${e.sentProductQuantity}</b>`,o.appendChild(i);const l=e.sentProductPrice*e.sentProductQuantity;n.push(l);const u=document.createElement("p");u.innerHTML=`Prix : <b><i>${l},00€</i></b>`,o.appendChild(u);const m=document.createElement("button");m.setAttribute("class","btn__delete-product"),m.setAttribute("name","delete-product"),m.setAttribute("type","button"),m.textContent="Supprimer",m.classList.add("btn","btn-success","fw-bold"),o.appendChild(m);const p=t.indexOf(e);m.addEventListener("click",(e=>{t.splice(p,1),localStorage.setItem("products",JSON.stringify(t)),0===t.length&&localStorage.removeItem("products"),location.reload()}))}));const o=n.reduce((function(t,e){return t+e}),0),c=document.createElement("div");c.setAttribute("id","total-price"),c.innerHTML=`<p><em>Prix total</em> : ${o},00€</p>`,c.classList.add("fs-1","text-center"),e.appendChild(c);const a=document.createElement("button");a.setAttribute("id","btn__empty-cart"),a.setAttribute("name","empty-cart"),a.setAttribute("type","button"),a.textContent="Supprimer tous les articles",a.classList.add("btn","btn-success","btn-lg","fw-bold"),c.appendChild(a),document.querySelector("#btn__empty-cart").addEventListener("click",(t=>{localStorage.clear(),window.alert("Le panier est désormais vide."),location.reload()})),confirmCart=document.querySelector("#btn__confirm-cart"),confirmCart.addEventListener("click",(e=>{e.preventDefault();const n={firstName:document.querySelector("#input__first-name").value,lastName:document.querySelector("#input__last-name").value,address:document.querySelector("#input__address").value,city:document.querySelector("#input__city").value,email:document.querySelector("#input__mail").value},r=/^[a-zA-Z-]{2,36}$/.test(n.firstName),c=/^[a-zA-Z\.-\s]{2,36}$/.test(n.lastName),a=/^[a-zA-Z0-9\.-\s]{8,240}$/.test(n.address),s=/^[a-zA-Z\.-\s]{2,50}$/.test(n.city),d=/^[a-zA-Z0-9_\.-]{3,40}@[a-zA-Z0-9-]{2,10}\.[a-zA-Z]{2,4}$/.test(n.email);function i(t,e){t?(document.querySelector(`.${e}--error`).textContent="",document.querySelector(`#${e}`).style.removeProperty("background-color")):(document.querySelector(`.${e}--error`).textContent="Champs à corriger.",document.querySelector(`#${e}`).style.backgroundColor="#d98531")}if(i(r,"input__first-name"),i(c,"input__last-name"),i(a,"input__address"),i(s,"input__city"),i(d,"input__mail"),r&&c&&a&&s&&d){localStorage.setItem("contact",JSON.stringify(n));const e=[];for(const n of t)e.push(n.sentProductId);const r={contact:n,products:e};fetch("http://localhost:3000/api/teddies/order",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}).then((async t=>{try{const e=await t.json();console.log("content",e),console.log("content.orderId",e.orderId);const n={orderAmount:o,orderId:e.orderId};localStorage.setItem("order",JSON.stringify(n)),window.location="order.html"}catch(t){console.error("error",t)}}))}else document.querySelector("#cart-invalid").textContent="Tous les champs ne sont pas correctement renseignés."}))}})();